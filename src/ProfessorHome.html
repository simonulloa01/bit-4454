<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professor Info</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
    :root {
        --smu-blue: #141B4D;
        /* SMU Blue, replace with actual code */
        --smu-red: #8A704C;
        /* SMU Red, replace with actual code */
    }

    .btn-primary {
        background-color: var(--smu-blue);
        border-color: var(--smu-blue);
    }

    .btn-primary:hover,
    .btn-primary:focus,
    .btn-primary:active {
        background-color: var(--smu-red) !important;
        border-color: var(--smu-red) !important;
    }

    .bg-primary {
        background-color: var(--smu-red) !important;
    }

    .navbar,
    .footer {
        background-color: var(--smu-blue);
    }

    h1 {
        color: var(--smu-blue);
    }

    /* Add more custom styles here, like for fonts if SMU has specific ones */
    body,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-family: sans-serif;

        /* replace 'Your-SMU-Font' with SMU's font if available */
    }

    /* If you have the SMU logo, you can style it here */
    .smu-logo {
        height: 60px;
        /* Or appropriate size */
    }

    .card {
        border: 1px solid var(--smu-blue);
        box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
    }

    .card-title {
        color: var(--smu-blue);
    }

    .card-body {
        position: relative;
        padding: 20px;
    }

    .pie-chart {
        position: absolute;
        right: 20px;
        top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.75rem;
        color: white;
    }

    .pie-chart-text {
        position: absolute;
        right: 35px;
        top: 35px;
    }

    .course-details {
        margin-bottom: 20px;
    }

    .course-detail-label {
        font-weight: bold;
    }
</style>

<body>
    <div class="container mt-5">
        <h1 class="text-center">SMU Peer Evaluation Professor Dashboard</h1>
        <div class="container mt-1 mb-5">
            <h1 class="text-center" id="professorName">Your dashboard is loading...</h1>
            <div id="coursesContainer" class="d-flex justify-content-center">
                <!-- Courses will be dynamically inserted here -->
                <img id="loadingImg" class="mt-5 d-block mx-auto"
                    src="https://cdn.pixabay.com/animation/2023/05/02/04/29/04-29-06-428_512.gif" height="100"
                    width="100" alt="Placeholder image" />
                <!-- Consider using "row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" for card columns -->
            </div>
        </div>

</body>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        const params = new URLSearchParams(window.location.search);
        const sessionId = params.get('session');

        if (!sessionId) {
            $('#professorName').text('Session ID not provided in the URL');
            return;
        }

        fetch(`/api/getProfessorInfo`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ session_id: sessionId })
        })
            .then(response => response.json())
            .then(data => {
                if (data.professorInfo && data.courses.length > 0) {
                    const professor = data.professorInfo;
                    $('#professorName').text(`Welcome to your dashboard ${professor.firstName} ${professor.lastName}.`);
                    $('#loadingImg').remove();
                    data.courses.forEach(course => {
                        let percentageComplete = course.totalEvaluations === 0 ? 0 : ((course.totalEvaluations - course.notCompletedEvaluations) / course.totalEvaluations) * 100;
                        let courseCardHtml = `
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">${course.courseName}</h5>
                                    <div class="course-details">
                                        <p class="course-detail-label">Course Code:</p>
                                        <p class="card-text">${course.courseCode}</p>
                                        <p class="course-detail-label">Semester:</p>
                                        <p class="card-text">${course.semester}</p>
                                        <p class="course-detail-label">Time:</p>
                                        <p class="card-text">${course.courseTime}</p>
                                        <p class="course-detail-label">Year:</p>
                                        <p class="card-text">${course.year}</p>
                                        <p class="course-detail-label">Due Dates:</p>
                                        <p class="card-text">${course.dueDates}</p>
                                        <p class="course-detail-label">Total Groups:</p>
                                        <p class="card-text">${course.totalGroups}</p>
                                        <p class="course-detail-label">Total Students:</p>
                                        <p class="card-text">${course.totalStudents}</p>
                                    </div>
                                    <div class="pie-chart" style="background-image: conic-gradient(green ${percentageComplete}%, red ${percentageComplete}%, red 100%); width: 100px; height: 100px; border-radius: 50%;">
                                        <span class="pie-chart-text">${percentageComplete.toFixed(2)}%</span>
                                    </div>
                                    <a href="/EditClass?session_id=${sessionId}&course_id=${course.courseId}" class="btn btn-primary">Edit Class</a>
                                </div>
                            </div>`;
                        $('#coursesContainer').append(courseCardHtml);
                    });
                } else {
                    $('#professorName').text('No data found');
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                $('#professorName').text('Error fetching data');
            });
    });
</script>

</html>